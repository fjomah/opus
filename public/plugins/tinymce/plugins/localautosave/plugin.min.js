/**
 * LAS - Local Auto Save Plugin
 * localautosave/plugin.min.js
 *
 * Released under The MIT License (MIT)
 *
 * License: https://github.com/valtlfelipe/TinyMCE-LocalAutoSave/blob/master/LICENSE.md
 * Plugin info: http://valtlfelipe.github.io/TinyMCE-LocalAutoSave/
 * Author: Felipe Valtl de Mello
 *
 * Version: 0.4.5 released 02/05/2016
 *
 *
 * Modified by Diego Valerio Camarda
 * https://github.com/dvcama/TinyMCE-LocalAutoSave
 *
 */
tinymce.PluginManager.requireLangPack("localautosave"),tinymce.PluginManager.add("localautosave",function(t){function e(t){return t.replace(/[\x00-\x1f]+|&nbsp;|&#160;/gi," ").replace(/(.)\1{5,}|[%&;=<]/g,function(t){return t.length>1?"%0"+t.charAt(0)+t.length.toString()+"%":L[t]})}function n(t){return t.replace(/%[1-5]|%0(.)(\d+)%/g,function(t,e,n){var a,o,r;if(2==t.length)return P[t];for(a=[],o=0,r=parseInt(n);r>o;o++)a.push(e);return a.join("")})}function o(t){return t.replace(/,/g,"&#44;")}function r(t){return t.replace(/&#44;/g,",")}function i(){var t=[];if(E)for(var e=0,n=E.length;n>e;e++){var a=E.key([e]);0==a.indexOf(N.keyName+O)&&t.push(E.getItem(a))}return t.sort(),t.reverse()}function l(t){var e=[];if(E)for(var n=0,a=E.length;a>n;n++){var o=E.key([n]);0==o.indexOf(N.keyName+O)&&e.push(o)}if(e.sort(function(t,e){return E.getItem(t)>E.getItem(e)}),e.reverse(),t>0){var r=e;if(e=[],t<r.length)for(var n=t,a=r.length;a>n;n++)e.push(r[n])}return e}function c(t){if(E)for(var e=0,n=t.length;n>e;e++)E.removeItem(t[e])}function s(){var t=now.getFullYear(),e=now.getMonth()+1,n=now.getDate(),a=now.getHours(),o=now.getMinutes(),r=now.getSeconds();return 10>e&&(e="0"+e),10>n&&(n="0"+n),10>a&&(a="0"+a),10>o&&(o="0"+o),10>r&&(r="0"+r),t+"-"+e+"-"+n+" "+a+":"+o+":"+r}function u(){{var e=null;t.editorManager.is}t.getContent().replace(/<\/?[a-z]+[^>]*>/gi,"").length>0&&z(),T=!0;try{if(E){var a=i();if(0===a.length)t.windowManager.alert("localautosave.noContent");else if(1===a.length&&0===t.getContent().replace(/\s|&nbsp;|<\/?p[^>]*>|<br[^>]*>/gi,"").length)t.setContent(r(a[0].substring(a[0].indexOf(",")+1))),T=!1;else{for(var o="<div class='localautosave_cnt' id=\""+O+"-popup-localautosave\"><ul id='localautosave_list'>",s=0,u=a.length;u>s;s++){var f=r(a[s].substring(a[s].indexOf(",")+1)),g=a[s].substring(0,a[s].indexOf(","));o+="<li class='clearfix'><label>"+g+"</label> <tt>("+f.replace(/<\/?[a-z]+[^>]*>/gi,"").length+" "+tinymce.translate("localautosave.chars")+")</tt><span>"+f+"</span></li>"}o+="</ul></div>",t.windowManager.open({width:380,height:240,scrollbars:!0,title:"localautosave.chooseVersion",html:o,buttons:[{text:"localautosave.clearAll",onclick:function(){c(l()),tinyMCE.activeEditor.windowManager.close()}},{text:"Cancel",onclick:"close"}]});var v=$("#"+O+"-popup-localautosave").find("li");$(".localautosave_cnt:first").height($(".localautosave_cnt:first").parent().height()-40),v.click(function(){tinyMCE.activeEditor.setContent($(this).children("span").html()),tinyMCE.activeEditor.windowManager.close()})}}else m=D.exec(document.cookie),m&&(e=n(m[1]))}catch(d){console.error(d),T=!1}}function f(e,n){var a=t,o=a.buttons,r=a.theme.panel.find("toolbar *"),i="undefined";if(typeof o[e]===i)return!1;var l=o[e],c=!1,s=0;return tinymce.each(l,function(t,e){("icon"==e||"text"==e||"tooltip"==e||"type"==e)&&s++}),tinymce.each(r,function(t){if("button"==t.type&&typeof t.settings!==i){var e=0;if(tinymce.each(t.settings,function(t,n){"icon"!=n&&"text"!=n&&"tooltip"!=n&&"type"!=n||l[n]!=t||e++}),e==s)return c=t,0!=n&&(c=t.getEl()),!1}}),c}function g(){var t=".mce-container .localautosave_cnt , .mce-container * .localautosave_cnt , .mce-widget .localautosave_cnt , .mce-widget * .localautosave_cnt {padding:20px;overflow: auto;} ";t+="#localautosave_list li {list-style:none;cursor:pointer;line-height:30px;border-bottom:1px solid #ddd;} ",t+="#localautosave_list li:hover {background-color:#ddd;} ",t+="#localautosave_list li span{display:none;} ",t+="#localautosave_list li tt{float:right;line-height: 30px;} ",t+="#localautosave_list li label{float:left;line-height: 30px;} ",t+='#localautosave_list .clearfix:before, #localautosave_list .clearfix:after { display: table; content: " "; } #localautosave_list .clearfix:after { clear: both; }',t+=".las-spin{-webkit-animation:las-spin 1s infinite linear;animation:las-spin 1s infinite linear;-webkit-animation-direction:reverse;animation-direction:reverse}@-webkit-keyframes las-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}@keyframes las-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(359deg);transform:rotate(359deg)}}",$("head").append("<style type='text/css'>"+t+"</style>")}function v(t,e){var n=t[0],a=t[1],o=t[2],r=t[3];n=h(n,a,o,r,e[0],7,-680876936),r=h(r,n,a,o,e[1],12,-389564586),o=h(o,r,n,a,e[2],17,606105819),a=h(a,o,r,n,e[3],22,-1044525330),n=h(n,a,o,r,e[4],7,-176418897),r=h(r,n,a,o,e[5],12,1200080426),o=h(o,r,n,a,e[6],17,-1473231341),a=h(a,o,r,n,e[7],22,-45705983),n=h(n,a,o,r,e[8],7,1770035416),r=h(r,n,a,o,e[9],12,-1958414417),o=h(o,r,n,a,e[10],17,-42063),a=h(a,o,r,n,e[11],22,-1990404162),n=h(n,a,o,r,e[12],7,1804603682),r=h(r,n,a,o,e[13],12,-40341101),o=h(o,r,n,a,e[14],17,-1502002290),a=h(a,o,r,n,e[15],22,1236535329),n=p(n,a,o,r,e[1],5,-165796510),r=p(r,n,a,o,e[6],9,-1069501632),o=p(o,r,n,a,e[11],14,643717713),a=p(a,o,r,n,e[0],20,-373897302),n=p(n,a,o,r,e[5],5,-701558691),r=p(r,n,a,o,e[10],9,38016083),o=p(o,r,n,a,e[15],14,-660478335),a=p(a,o,r,n,e[4],20,-405537848),n=p(n,a,o,r,e[9],5,568446438),r=p(r,n,a,o,e[14],9,-1019803690),o=p(o,r,n,a,e[3],14,-187363961),a=p(a,o,r,n,e[8],20,1163531501),n=p(n,a,o,r,e[13],5,-1444681467),r=p(r,n,a,o,e[2],9,-51403784),o=p(o,r,n,a,e[7],14,1735328473),a=p(a,o,r,n,e[12],20,-1926607734),n=y(n,a,o,r,e[5],4,-378558),r=y(r,n,a,o,e[8],11,-2022574463),o=y(o,r,n,a,e[11],16,1839030562),a=y(a,o,r,n,e[14],23,-35309556),n=y(n,a,o,r,e[1],4,-1530992060),r=y(r,n,a,o,e[4],11,1272893353),o=y(o,r,n,a,e[7],16,-155497632),a=y(a,o,r,n,e[10],23,-1094730640),n=y(n,a,o,r,e[13],4,681279174),r=y(r,n,a,o,e[0],11,-358537222),o=y(o,r,n,a,e[3],16,-722521979),a=y(a,o,r,n,e[6],23,76029189),n=y(n,a,o,r,e[9],4,-640364487),r=y(r,n,a,o,e[12],11,-421815835),o=y(o,r,n,a,e[15],16,530742520),a=y(a,o,r,n,e[2],23,-995338651),n=w(n,a,o,r,e[0],6,-198630844),r=w(r,n,a,o,e[7],10,1126891415),o=w(o,r,n,a,e[14],15,-1416354905),a=w(a,o,r,n,e[5],21,-57434055),n=w(n,a,o,r,e[12],6,1700485571),r=w(r,n,a,o,e[3],10,-1894986606),o=w(o,r,n,a,e[10],15,-1051523),a=w(a,o,r,n,e[1],21,-2054922799),n=w(n,a,o,r,e[8],6,1873313359),r=w(r,n,a,o,e[15],10,-30611744),o=w(o,r,n,a,e[6],15,-1560198380),a=w(a,o,r,n,e[13],21,1309151649),n=w(n,a,o,r,e[4],6,-145523070),r=w(r,n,a,o,e[11],10,-1120210379),o=w(o,r,n,a,e[2],15,718787259),a=w(a,o,r,n,e[9],21,-343485551),t[0]=I(n,t[0]),t[1]=I(a,t[1]),t[2]=I(o,t[2]),t[3]=I(r,t[3])}function d(t,e,n,a,o,r){return e=I(I(e,t),I(a,r)),I(e<<o|e>>>32-o,n)}function h(t,e,n,a,o,r,i){return d(e&n|~e&a,t,e,o,r,i)}function p(t,e,n,a,o,r,i){return d(e&a|n&~a,t,e,o,r,i)}function y(t,e,n,a,o,r,i){return d(e^n^a,t,e,o,r,i)}function w(t,e,n,a,o,r,i){return d(n^(e|~a),t,e,o,r,i)}function k(t){txt="";var e,n=t.length,a=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)v(a,x(t.substring(e-64,e)));t=t.substring(e-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)o[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(o[e>>2]|=128<<(e%4<<3),e>55)for(v(a,o),e=0;16>e;e++)o[e]=0;return o[14]=8*n,v(a,o),a}function x(t){var e,n=[];for(e=0;64>e;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}function C(t){for(var e="",n=0;4>n;n++)e+=V[t>>8*n+4&15]+V[t>>8*n&15];return e}function _(t){for(var e=0;e<t.length;e++)t[e]=C(t[e]);return t.join("")}function A(t){return _(k(t))}function I(t,e){return t+e&4294967295}function I(t,e){var n=(65535&t)+(65535&e),a=(t>>16)+(e>>16)+(n>>16);return a<<16|65535&n}function v(t,e){var n=t[0],a=t[1],o=t[2],r=t[3];n=h(n,a,o,r,e[0],7,-680876936),r=h(r,n,a,o,e[1],12,-389564586),o=h(o,r,n,a,e[2],17,606105819),a=h(a,o,r,n,e[3],22,-1044525330),n=h(n,a,o,r,e[4],7,-176418897),r=h(r,n,a,o,e[5],12,1200080426),o=h(o,r,n,a,e[6],17,-1473231341),a=h(a,o,r,n,e[7],22,-45705983),n=h(n,a,o,r,e[8],7,1770035416),r=h(r,n,a,o,e[9],12,-1958414417),o=h(o,r,n,a,e[10],17,-42063),a=h(a,o,r,n,e[11],22,-1990404162),n=h(n,a,o,r,e[12],7,1804603682),r=h(r,n,a,o,e[13],12,-40341101),o=h(o,r,n,a,e[14],17,-1502002290),a=h(a,o,r,n,e[15],22,1236535329),n=p(n,a,o,r,e[1],5,-165796510),r=p(r,n,a,o,e[6],9,-1069501632),o=p(o,r,n,a,e[11],14,643717713),a=p(a,o,r,n,e[0],20,-373897302),n=p(n,a,o,r,e[5],5,-701558691),r=p(r,n,a,o,e[10],9,38016083),o=p(o,r,n,a,e[15],14,-660478335),a=p(a,o,r,n,e[4],20,-405537848),n=p(n,a,o,r,e[9],5,568446438),r=p(r,n,a,o,e[14],9,-1019803690),o=p(o,r,n,a,e[3],14,-187363961),a=p(a,o,r,n,e[8],20,1163531501),n=p(n,a,o,r,e[13],5,-1444681467),r=p(r,n,a,o,e[2],9,-51403784),o=p(o,r,n,a,e[7],14,1735328473),a=p(a,o,r,n,e[12],20,-1926607734),n=y(n,a,o,r,e[5],4,-378558),r=y(r,n,a,o,e[8],11,-2022574463),o=y(o,r,n,a,e[11],16,1839030562),a=y(a,o,r,n,e[14],23,-35309556),n=y(n,a,o,r,e[1],4,-1530992060),r=y(r,n,a,o,e[4],11,1272893353),o=y(o,r,n,a,e[7],16,-155497632),a=y(a,o,r,n,e[10],23,-1094730640),n=y(n,a,o,r,e[13],4,681279174),r=y(r,n,a,o,e[0],11,-358537222),o=y(o,r,n,a,e[3],16,-722521979),a=y(a,o,r,n,e[6],23,76029189),n=y(n,a,o,r,e[9],4,-640364487),r=y(r,n,a,o,e[12],11,-421815835),o=y(o,r,n,a,e[15],16,530742520),a=y(a,o,r,n,e[2],23,-995338651),n=w(n,a,o,r,e[0],6,-198630844),r=w(r,n,a,o,e[7],10,1126891415),o=w(o,r,n,a,e[14],15,-1416354905),a=w(a,o,r,n,e[5],21,-57434055),n=w(n,a,o,r,e[12],6,1700485571),r=w(r,n,a,o,e[3],10,-1894986606),o=w(o,r,n,a,e[10],15,-1051523),a=w(a,o,r,n,e[1],21,-2054922799),n=w(n,a,o,r,e[8],6,1873313359),r=w(r,n,a,o,e[15],10,-30611744),o=w(o,r,n,a,e[6],15,-1560198380),a=w(a,o,r,n,e[13],21,1309151649),n=w(n,a,o,r,e[4],6,-145523070),r=w(r,n,a,o,e[11],10,-1120210379),o=w(o,r,n,a,e[2],15,718787259),a=w(a,o,r,n,e[9],21,-343485551),t[0]=I(n,t[0]),t[1]=I(a,t[1]),t[2]=I(o,t[2]),t[3]=I(r,t[3])}function d(t,e,n,a,o,r){return e=I(I(e,t),I(a,r)),I(e<<o|e>>>32-o,n)}function h(t,e,n,a,o,r,i){return d(e&n|~e&a,t,e,o,r,i)}function p(t,e,n,a,o,r,i){return d(e&a|n&~a,t,e,o,r,i)}function y(t,e,n,a,o,r,i){return d(e^n^a,t,e,o,r,i)}function w(t,e,n,a,o,r,i){return d(n^(e|~a),t,e,o,r,i)}function k(t){txt="";var e,n=t.length,a=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)v(a,x(t.substring(e-64,e)));t=t.substring(e-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)o[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(o[e>>2]|=128<<(e%4<<3),e>55)for(v(a,o),e=0;16>e;e++)o[e]=0;return o[14]=8*n,v(a,o),a}function x(t){var e,n=[];for(e=0;64>e;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}function C(t){for(var e="",n=0;4>n;n++)e+=V[t>>8*n+4&15]+V[t>>8*n&15];return e}function _(t){for(var e=0;e<t.length;e++)t[e]=C(t[e]);return t.join("")}function A(t){return _(k(t))}function I(t,e){return t+e&4294967295}function I(t,e){var n=(65535&t)+(65535&e),a=(t>>16)+(e>>16)+(n>>16);return a<<16|65535&n}var M=($(t.formElement),!1),S=!1,O=t.id,T=!1,E=localStorage,j=null,L={"%":"%1","&":"%2",";":"%3","=":"%4","<":"%5"},P={"%1":"%","%2":"&","%3":";","%4":"=","%5":"<"},N={seconds:t.getParam("las_seconds")||6,keyName:t.getParam("las_keyName")||"LocalAutoSave",callback:t.getParam("las_callback"),versions:t.getParam("las_nVersions")||15},D=new RegExp("(?:^|;\\s*)"+N.keyName+O+"=([^;]*)(?:;|$)","i");g();try{E.setItem("LASTest","OK"),"OK"===E.getItem("LASTest")&&(E.removeItem("LASTest"),M=!0)}catch(K){try{E=sessionStorage,E.setItem("LASTest","OK"),"OK"===E.getItem("LASTest")&&(E.removeItem("LASTest"),S=!0)}catch(K){E=null}}var z=(t.addButton("localautosave",{text:"",icon:"restoredraft",tooltip:"localautosave.restoreContent",onclick:function(){for(z();!T;)u()}}),function(){if(!T&&t.isDirty()){T=!0,content=t.getContent(),is=t.editorManager.is;var n=!1;if(is(content,"string")&&content.length>0){now=new Date,exp=new Date(now.getTime()+12e5);var r=N.keyName+O;if(N.versions>0&&(r+=A(content)),0===N.versions||j!=r){try{E?E.getItem(r)||E.setItem(r,s(now)+","+o(content)):(a=r+"=",b="; expires="+exp.toUTCString(),document.cookie=a+e(content).slice(0,4096-a.length-b.length)+b),n=!0}catch(i){console.error(i)}if(n){obj=new Object,obj.content=content,obj.time=now.getTime(),N.callback&&N.callback.call(obj);var u=f("localautosave");$(u).find("i").addClass("las-spin");{setTimeout(function(){$(u).find("i").removeClass("las-spin")},2e3)}}}n&&(j=r),N.versions>0&&c(l(N.versions))}}T=!1}),V=(setInterval(z,1e3*N.seconds),"0123456789abcdef".split(""));"5d41402abc4b2a76b9719d911017c592"!=A("hello");var V="0123456789abcdef".split("");"5d41402abc4b2a76b9719d911017c592"!=A("hello")});
